<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dreamland Motor ‚Äî Inventory Admin</title>
<meta name="description" content="Dreamland Motor ‚Äî Inventory Manager (Admin)" />
<link rel="icon" href="dreamland_logo.png" />

<style>
  :root{
    --bg:#071018;
    --card:#0b2230;
    --muted:#9fb6c1;
    --accent:#10d7ff;
    --accent-2:#06b3d6;
    --danger:#ff6b6b;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
    --pad:18px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;}
  body{
    margin:0;background:linear-gradient(180deg,#04121a 0%, #071018 100%);
    color:#dff3f7; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    padding-bottom:40px;
  }
  /* sticky nav */
  header{
    position:sticky; top:0; z-index:999; backdrop-filter: blur(6px);
    background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));
    border-bottom:1px solid rgba(255,255,255,0.03);
  }
  .nav{
    max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:10px 16px;
  }
  .logo{
    display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--accent);
  }
  .logo img{width:42px;height:42px;border-radius:8px;object-fit:cover;}
  .brand{font-weight:700;font-size:20px;line-height:1;color:var(--accent);text-shadow:0 2px 8px rgba(0,0,0,0.6);}
  .navlinks{margin-left:auto;display:flex;gap:14px;align-items:center}
  .navlinks a{color:#fff;text-decoration:none;opacity:0.85;font-size:15px}
  .container{max-width:1100px;margin:20px auto;padding:12px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:var(--pad); box-shadow:0 8px 30px rgba(2,10,16,0.6); border:1px solid rgba(255,255,255,0.02)}
  h1{margin:0 0 8px 0;color:var(--accent)}
  p.lead{color:var(--muted);margin:0 0 12px 0}
  /* unlock card */
  .lockWrap{display:flex;flex-direction:column;gap:12px;max-width:720px;margin:12px auto}
  .lockAlert{border-radius:12px;padding:12px;background:linear-gradient(90deg, rgba(16,215,255,0.06), rgba(6,179,214,0.03)); border:1px solid rgba(16,215,255,0.06)}
  .formRow{display:flex;gap:10px;align-items:center}
  input[type="password"], input[type="text"], input[type="number"], textarea, select{
    background:var(--glass); border:1px solid rgba(255,255,255,0.04); color: #e6fbff; padding:12px; border-radius:10px; min-width:0;
    font-size:15px; outline:none;
  }
  input[type="file"]{color:var(--muted)}
  .btn{
    background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#001b20; padding:10px 16px;border-radius:12px;border:none;font-weight:700;
    box-shadow:0 6px 22px rgba(6,179,214,0.12); cursor:pointer;
  }
  .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(16,215,255,0.08)}
  .btn.danger{background:linear-gradient(90deg,var(--danger),#ff8a8a);color:#300}
  .small{font-size:13px;color:var(--muted)}
  /* admin panel layout */
  .adminGrid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:14px}
  @media (max-width:900px){ .adminGrid{grid-template-columns:1fr} .navlinks{display:none} .brand{font-size:18px} }
  .formCard{display:flex;flex-direction:column;gap:8px}
  label{font-size:13px;color:var(--muted)}
  .fieldGroup{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  @media (max-width:700px){ .fieldGroup{grid-template-columns:1fr} }
  .inventoryList{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:12px}
  .carCard{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
  .carHeader{display:flex;gap:10px;align-items:center}
  .carThumb{width:84px;height:56px;border-radius:8px;object-fit:cover;background:#03141a;border:1px solid rgba(255,255,255,0.03)}
  .carTitle{font-weight:700;color:#d0fbff}
  .carMeta{font-size:13px;color:var(--muted)}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{background:rgba(255,255,255,0.02);padding:6px 8px;border-radius:8px;font-size:12px;color:var(--muted)}
  .cardActions{display:flex;gap:8px;margin-top:10px}
  .mutedSmall{color:var(--muted);font-size:13px}
  footer{max-width:1100px;margin:24px auto;padding:12px;color:var(--muted);text-align:center}
  /* tiny helpers */
  .right{text-align:right}
  .hidden{display:none}
  .notice{padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02);color:var(--muted)}
  .flex{display:flex;gap:8px;align-items:center}
  .grow{flex:1}
</style>
</head>
<body>

<header>
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <a class="logo" href="./">
      <img src="dreamland_logo.png" alt="Dreamland logo" />
      <div>
        <div class="brand">Dreamland Motor</div>
        <div style="font-size:12px;color:#bfeff7">Engine Diagnostics & Repair Advisor</div>
      </div>
    </a>
    <div class="navlinks" role="menubar" aria-label="Main menu">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="services.html">Services</a>
      <a href="cars.html">Cars For Sale</a>
      <a href="contact.html">Contact</a>
    </div>
  </nav>
</header>

<main class="container" role="main">
  <section class="panel lockWrap" id="lockScreen">
    <div class="lockAlert">
      <strong>üîí Authorized Dreamland Staff Only.</strong>
      <p class="small">This page manages live inventory. For GitHub Pages security, entries are stored locally in your browser and exported to <code>cars.json</code> for upload. Do not share the access code.</p>
    </div>

    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
      <div style="flex:1">
        <h1 class="mutedSmall" style="margin:0">Admin Login</h1>
        <p class="small">Enter access code to unlock the inventory manager.</p>
      </div>
      <div style="text-align:right">
        <button class="btn ghost" id="helpBtn" title="Help">Help</button>
      </div>
    </div>

    <div class="formRow" style="margin-top:6px">
      <input id="passInput" type="password" placeholder="Enter access code" aria-label="Access code" />
      <button id="unlockBtn" class="btn">Unlock</button>
    </div>
    <div id="lockMsg" class="small mutedSmall" aria-live="polite"></div>
    <div style="margin-top:8px" class="small">‚ö†Ô∏è Keep this code safe. Default staff code: <strong>Engineer.1</strong></div>
  </section>

  <!-- Admin panel (hidden until unlocked) -->
  <section id="adminPanel" class="hidden">
    <div class="panel">
      <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
        <div style="flex:1">
          <h1>Inventory Manager</h1>
          <p class="lead">Add used car listings with rich metadata. Entries are saved locally and can be exported as <code>cars.json</code>.</p>
        </div>
        <div class="flex">
          <button id="exportBtn" class="btn">Export JSON</button>
          <label class="btn ghost" style="display:inline-block;cursor:pointer">
            Import JSON <input id="importFile" type="file" accept=".json" style="display:none" />
          </label>
          <button id="clearAll" class="btn danger">Clear All</button>
        </div>
      </div>

      <div class="adminGrid" style="margin-top:14px">
        <!-- Left: inventory -->
        <div>
          <div class="mutedSmall">Live inventory</div>
          <div id="inventoryArea" class="inventoryList" aria-live="polite" style="margin-top:8px"></div>
          <div id="emptyNotice" class="notice" style="margin-top:12px">No cars yet. Add one using the form to the right.</div>
        </div>

        <!-- Right: add/edit form -->
        <aside class="panel formCard">
          <h2 style="margin:0">Add / Edit Car</h2>
          <div class="small mutedSmall">Fill required fields then click Add or Save</div>

          <label>Make *</label>
          <input id="fieldMake" type="text" placeholder="Toyota" />

          <label>Model *</label>
          <input id="fieldModel" type="text" placeholder="Corolla" />

          <div class="fieldGroup">
            <div>
              <label>Year *</label>
              <input id="fieldYear" type="number" min="1996" max="2025" placeholder="2010" />
            </div>
            <div>
              <label>Price (‚Ç¶)</label>
              <input id="fieldPrice" type="number" min="0" placeholder="e.g. 1,200,000" />
            </div>
          </div>

          <label>Engine *</label>
          <input id="fieldEngine" type="text" placeholder="1.8L 1ZZ-FE (Petrol)" />

          <label>VIN</label>
          <input id="fieldVIN" type="text" placeholder="JTDB... (optional)" />

          <div class="fieldGroup">
            <div>
              <label>Mileage (km)</label>
              <input id="fieldMileage" type="number" min="0" placeholder="120000" />
            </div>
            <div>
              <label>Condition</label>
              <select id="fieldCondition">
                <option value="used">Used</option>
                <option value="fair">Fair</option>
                <option value="good">Good</option>
                <option value="excellent">Excellent</option>
              </select>
            </div>
          </div>

          <label>What's good (short bullet list)</label>
          <textarea id="fieldGood" rows="3" placeholder="Well maintained, new tires, recent service"></textarea>

          <label>What's not good (short bullet list)</label>
          <textarea id="fieldBad" rows="3" placeholder="Minor dent, AC low cooling"></textarea>

          <label>Image URL (optional)</label>
          <input id="fieldImage" type="text" placeholder="https://.../car.jpg" />

          <div style="display:flex;gap:8px;margin-top:6px">
            <button id="saveBtn" class="btn">Add Listing</button>
            <button id="resetBtn" class="btn ghost">Reset</button>
          </div>
          <div class="small" style="margin-top:8px;color:var(--muted)">Tip: use descriptive text for good/bad to help buyers decide.</div>
        </aside>
      </div>
    </div>
  </section>

  <div style="height:18px"></div>
</main>

<footer>
  ¬© 2025 Dreamland Motor Engineering Works | Secure Admin
</footer>

<script>
/* ===========================
   Admin Unlock / Security
   =========================== */
(function(){
  const PASS = "Engineer.1"; // the admin unlock code (client-side)
  const passInput = document.getElementById("passInput");
  const unlockBtn = document.getElementById("unlockBtn");
  const lockMsg = document.getElementById("lockMsg");
  const lockScreen = document.getElementById("lockScreen");
  const adminPanel = document.getElementById("adminPanel");
  const helpBtn = document.getElementById("helpBtn");

  function setMessage(txt, isError){
    lockMsg.textContent = txt || "";
    lockMsg.style.color = isError ? "var(--danger)" : "var(--muted)";
  }

  function unlockFlow(){
    unlockBtn.disabled = true;
    unlockBtn.textContent = "Checking...";
    setTimeout(()=>{
      const val = passInput.value.trim();
      if(val === PASS){
        setMessage("üîì Access granted ‚Äî Welcome, Engineer.", false);
        lockScreen.style.display = "none";
        adminPanel.classList.remove("hidden");
        // focus the first field
        setTimeout(()=>document.getElementById("fieldMake").focus(), 200);
      } else {
        setMessage("‚ùå Wrong code. Please try again.", true);
      }
      unlockBtn.disabled = false;
      unlockBtn.textContent = "Unlock";
      passInput.value = "";
    }, 450);
  }

  unlockBtn.addEventListener("click", unlockFlow);
  passInput.addEventListener("keydown", (e)=>{ if(e.key === "Enter") unlockFlow(); });

  helpBtn.addEventListener("click", ()=> {
    alert("Admin access required. Default staff code: Engineer.1\n\nNote: This is client-side protection for convenience on GitHub Pages. Keep your repo secure.");
  });

  // If an admin unlocked previously this session, keep it (sessionStorage only)
  if(sessionStorage.getItem("da_unlocked") === "1"){
    lockScreen.style.display = "none";
    adminPanel.classList.remove("hidden");
  }
  // when unlocking, mark sessionStorage
  const origUnlock = unlockFlow;
  unlockBtn.addEventListener("click", ()=>{ if(!lockScreen.style.display || lockScreen.style.display !== "none") { if(passInput.value.trim() === PASS) sessionStorage.setItem("da_unlocked","1"); }});
})();

/* ===========================
   Inventory Manager (localStorage)
   =========================== */
(function(){
  const STORAGE_KEY = "dreamland_cars_v1";
  let cars = [];
  let editId = null;

  // DOM
  const emptyNotice = document.getElementById("emptyNotice");
  const inventoryArea = document.getElementById("inventoryArea");
  const saveBtn = document.getElementById("saveBtn");
  const resetBtn = document.getElementById("resetBtn");
  const exportBtn = document.getElementById("exportBtn");
  const importFile = document.getElementById("importFile");
  const clearAll = document.getElementById("clearAll");

  const fMake = document.getElementById("fieldMake");
  const fModel = document.getElementById("fieldModel");
  const fYear = document.getElementById("fieldYear");
  const fPrice = document.getElementById("fieldPrice");
  const fEngine = document.getElementById("fieldEngine");
  const fVIN = document.getElementById("fieldVIN");
  const fMileage = document.getElementById("fieldMileage");
  const fCondition = document.getElementById("fieldCondition");
  const fGood = document.getElementById("fieldGood");
  const fBad = document.getElementById("fieldBad");
  const fImage = document.getElementById("fieldImage");

  function load() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      cars = raw ? JSON.parse(raw) : [];
    } catch(e){
      console.error("Failed to load inventory:", e);
      cars = [];
    }
    render();
  }

  function saveStorage(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(cars));
  }

  function uid(){
    return 'c'+Date.now().toString(36)+Math.random().toString(36).slice(2,8);
  }

  function clearForm(){
    editId = null;
    fMake.value = ""; fModel.value=""; fYear.value=""; fPrice.value="";
    fEngine.value=""; fVIN.value=""; fMileage.value=""; fCondition.value="used";
    fGood.value=""; fBad.value=""; fImage.value="";
    saveBtn.textContent = "Add Listing";
  }

  function validateForm(){
    if(!fMake.value.trim()) return "Make is required.";
    if(!fModel.value.trim()) return "Model is required.";
    const y = parseInt(fYear.value,10);
    if(!y || y < 1996 || y > 2025) return "Year must be between 1996 and 2025.";
    if(!fEngine.value.trim()) return "Engine description required.";
    return null;
  }

  function addOrUpdate(){
    const err = validateForm();
    if(err){ alert(err); return; }
    const item = {
      id: editId || uid(),
      make: fMake.value.trim(),
      model: fModel.value.trim(),
      year: parseInt(fYear.value,10),
      price: fPrice.value ? Number(fPrice.value) : null,
      engine: fEngine.value.trim(),
      vin: fVIN.value.trim() || null,
      mileage: fMileage.value ? Number(fMileage.value) : null,
      condition: fCondition.value,
      good: fGood.value.trim(),
      bad: fBad.value.trim(),
      image: fImage.value.trim() || "",
      created: editId ? (cars.find(c=>c.id===editId)||{}).created : new Date().toISOString(),
      updated: new Date().toISOString()
    };

    if(editId){
      cars = cars.map(c => c.id===editId ? item : c);
      editId = null;
    } else {
      cars.unshift(item); // newest first
    }
    saveStorage();
    render();
    clearForm();
  }

  function render(){
    inventoryArea.innerHTML = "";
    if(!cars.length){
      emptyNotice.style.display = "block";
      return;
    }
    emptyNotice.style.display = "none";
    cars.forEach(car => {
      const card = document.createElement("article");
      card.className = "carCard";
      card.innerHTML = `
        <div class="carHeader">
          <img class="carThumb" src="${escapeHtml(car.image)||'https://via.placeholder.com/320x180?text=No+Image'}" alt="${escapeHtml(car.make)} ${escapeHtml(car.model)}" />
          <div style="flex:1">
            <div class="carTitle">${escapeHtml(car.make)} ${escapeHtml(car.model)}</div>
            <div class="carMeta">${car.year} ‚Ä¢ ${car.engine} ‚Ä¢ ${car.mileage?car.mileage+' km':''}</div>
            <div class="carMeta" style="margin-top:6px">${car.price?formatCurrency(car.price):'<span style="color:var(--muted)">Price not set</span>'}</div>
          </div>
        </div>
        <div class="chips">
          <div class="chip">Condition: ${escapeHtml(car.condition)}</div>
          ${car.vin?'<div class="chip">VIN: '+escapeHtml(car.vin)+'</div>':''}
          <div class="chip">Added: ${new Date(car.created).toLocaleDateString()}</div>
        </div>
        <div style="margin-top:8px;color:var(--muted);font-size:13px">
          <strong>What's good:</strong><div>${escapeHtml(car.good || '‚Äî')}</div>
          <strong style="margin-top:6px;display:block">What's not good:</strong><div>${escapeHtml(car.bad || '‚Äî')}</div>
        </div>
        <div class="cardActions">
          <button class="btn" data-action="edit" data-id="${car.id}">Edit</button>
          <button class="btn ghost" data-action="view" data-id="${car.id}">View</button>
          <button class="btn ghost" data-action="clone" data-id="${car.id}">Clone</button>
          <button class="btn danger" data-action="delete" data-id="${car.id}">Delete</button>
        </div>
      `;
      inventoryArea.appendChild(card);
    });

    // attach handlers
    inventoryArea.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        const car = cars.find(c=>c.id===id);
        if(!car) return;
        if(action==='edit') startEdit(car);
        if(action==='view') viewCar(car);
        if(action==='delete') {
          if(confirm('Delete this listing? This action is irreversible.')) {
            cars = cars.filter(c=>c.id!==id); saveStorage(); render();
          }
        }
        if(action==='clone'){
          const clone = Object.assign({}, car, { id: uid(), created: new Date().toISOString(), updated: new Date().toISOString() });
          cars.unshift(clone); saveStorage(); render();
          alert('Cloned listing created. Edit details as needed.');
        }
      });
    });
  }

  function startEdit(car){
    editId = car.id;
    fMake.value = car.make || "";
    fModel.value = car.model || "";
    fYear.value = car.year || "";
    fPrice.value = car.price || "";
    fEngine.value = car.engine || "";
    fVIN.value = car.vin || "";
    fMileage.value = car.mileage || "";
    fCondition.value = car.condition || "used";
    fGood.value = car.good || "";
    fBad.value = car.bad || "";
    fImage.value = car.image || "";
    saveBtn.textContent = "Save Changes";
    window.scrollTo({top:0,behavior:'smooth'});
  }

  function viewCar(car){
    const text = `
${car.make} ${car.model} (${car.year})
Engine: ${car.engine}
Mileage: ${car.mileage ? car.mileage + " km" : "‚Äî"}
Price: ${car.price ? formatCurrency(car.price) : "‚Äî"}
Condition: ${car.condition}
VIN: ${car.vin || "‚Äî"}

What's good:
${car.good || "‚Äî"}

What's not good:
${car.bad || "‚Äî"}
    `;
    alert(text);
  }

  function formatCurrency(n){
    try{
      return new Intl.NumberFormat('en-NG', {style:'currency', currency:'NGN'}).format(n);
    }catch(e){
      return "‚Ç¶" + n.toLocaleString();
    }
  }

  function escapeHtml(s){
    if(!s && s !== 0) return "";
    return String(s)
      .replace(/&/g,"&amp;")
      .replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;")
      .replace(/'/g,"&#039;")
      .replace(/\n/g,"<br>");
  }

  /* Export / Import */
  exportBtn.addEventListener("click", ()=>{
    const blob = new Blob([JSON.stringify(cars, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "cars.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });

  importFile.addEventListener("change", (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(ev){
      try{
        const imported = JSON.parse(ev.target.result);
        if(!Array.isArray(imported)) throw new Error("Invalid file: expected an array of listings");
        // merge imported items (avoid id collisions)
        imported.forEach(item=>{
          if(!item.id) item.id = uid();
          cars.unshift(item);
        });
        saveStorage(); render();
        alert("Imported " + imported.length + " listings.");
      }catch(err){
        alert("Import failed: " + err.message);
      }
    };
    reader.readAsText(f);
    importFile.value = "";
  });

  clearAll.addEventListener("click", ()=>{
    if(confirm("Permanently delete ALL listings from this browser? This cannot be undone.")){
      cars = []; saveStorage(); render();
      alert("All listings removed locally.");
    }
  });

  saveBtn.addEventListener("click", addOrUpdate);
  resetBtn.addEventListener("click", clearForm);

  // load initial example set if no data
  function seedIfEmpty(){
    if(!localStorage.getItem(STORAGE_KEY)){
      cars = [
        {
          id: uid(), make: "Toyota", model: "Corolla", year: 2010, price: 1500000,
          engine: "1.6L 1ZR-FE Petrol", vin: "", mileage: 145000, condition:"good",
          good: "Economical, reliable engine, recent brakes", bad:"Minor paint fade, AC needs regas",
          image:"https://via.placeholder.com/640x360?text=Toyota+Corolla+2010", created:new Date().toISOString(), updated:new Date().toISOString()
        }
      ];
      saveStorage();
    }
  }

  seedIfEmpty();
  load();

  // Small helper to show current data on console for debugging
  window.DREAMLAND_INVENTORY = {
    list: ()=>cars,
    export: ()=>JSON.stringify(cars, null, 2),
    clear: ()=>{cars=[];saveStorage();render();}
  };

})();
</script>
</body>
</html>
